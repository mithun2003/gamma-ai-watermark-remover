<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Watermark Remover</title>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    body {
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      color: #e0e0e0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    .container {
      background: rgba(40, 40, 40, 0.95);
      padding: 40px 50px;
      border-radius: 20px;
      text-align: center;
      width: 100%;
      max-width: 650px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 25px 50px rgba(0,0,0,0.8);
    }
    h1 {
      margin-bottom: 30px !important;
      font-weight: 300;
      font-size: 1.8em;
      color: #ddd;
    }
    .file-upload-wrapper {
      margin-bottom: 30px;
    }
    .file-upload-label {
      display: inline-block;
      width: 100%;
      padding: 20px 0px;
      border-radius: 15px;
      background: linear-gradient(135deg,#4a4a4a,#555);
      border: 2px solid rgba(255,255,255,0.1);
      color:#f0f0f0;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    .file-upload-label:hover { background: linear-gradient(135deg,#555,#666); }
    .file-upload-label i { margin-right: 8px; }
    .file-upload-input { display: none; }
    .file-upload-text {
      display: block; margin-top: 12px;
      font-size: 0.9em; color:#bbb; font-style: italic;
    }
    button[type="submit"] {
      padding: 15px 40px;
      border: none; border-radius: 15px;
      background: linear-gradient(135deg,#7b68ee,#6a5acd);
      color:#fff; font-size: 1.1em;
      cursor:pointer; transition: all .3s ease;
    }
    button[disabled] { opacity:0.6; cursor:not-allowed; }
    /* Notifications */
    .notification {
      margin-top: 25px;
      padding: 15px 40px 15px 15px;
      border-radius: 12px;
      color: #fff;
      display: none;
      text-align: left;
      position: relative;
    }
    .notification.error { background: rgba(211,47,47,0.9); }
    .notification.success { background: rgba(67,160,71,0.9); }
    .close-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      cursor: pointer;
      font-size: 18px;
      color: #fff;
      opacity: 0.7;
      transition: opacity 0.2s ease;
    }
    .close-btn:hover { opacity: 1; }
  </style>
</head>
<body>
  <div class="container">
    <h1><i class="fas fa-tint-slash"></i> Gamma AI Watermark Remover</h1>

    <form id="watermarkForm" enctype="multipart/form-data">
      <div class="file-upload-wrapper">
        <label class="file-upload-label" for="pdfFile">
          <i class="fas fa-upload"></i> Choose PDF File
        </label>
        <input type="file" name="pdf_file" class="file-upload-input" accept=".pdf" id="pdfFile">
        <span class="file-upload-text" id="fileNameText">No file chosen.</span>
      </div>
      <button type="submit" id="submitBtn"><i class="fas fa-magic"></i> Remove Watermark</button>
    </form>

    <div id="notification" class="notification">
        <span id="notif-msg"></span>
        <span class="close-btn" id="notif-close">&times;</span>
    </div>
  </div>

<script>
  const form = document.getElementById("watermarkForm");
  const fileInput = document.getElementById("pdfFile");
  const submitBtn = document.getElementById("submitBtn");
  const notif = document.getElementById("notification");
  const notifIcon = document.getElementById("notif-icon");
  const notifMsg = document.getElementById("notif-msg");
  const notifClose = document.getElementById("notif-close");
  const fileNameText = document.getElementById("fileNameText");

  fileInput.addEventListener('change', function() {
    fileNameText.textContent = this.files.length ? this.files[0].name : 'No file chosen.';
  });

  notifClose.addEventListener("click", () => {
    notif.style.display = "none"; // simply hide
  });

  form.addEventListener("submit", async function(e) {
    e.preventDefault();
    const file = fileInput.files[0];
    if (!file) { showError("⚠️ Please select a PDF file before submitting."); return; }

    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

    const formData = new FormData();
    formData.append("pdf_file", file);

    try {
      const response = await fetch("/remove_watermark", { method: "POST", body: formData });
      const contentType = response.headers.get("Content-Type");

      if (response.ok && contentType && contentType.includes("application/pdf")) {
        const blob = await response.blob();
        const disposition = response.headers.get("Content-Disposition");
        const match = disposition ? disposition.match(/filename="?([^"]+)"?/) : null;
        const filename = match ? match[1] : "processed.pdf";

        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        showSuccess("✅ Watermark removed successfully! File downloaded.");
      } else {
        const text = await response.text();
        showError("Server error: " + text);
      }
    } catch (err) {
      showError("Upload failed: " + err.message);
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = '<i class="fas fa-magic"></i> Remove Watermark';
    }
  });

  function showError(msg) {
    notif.className = "notification error";
    notif.style.display = "block";
    notifMsg.textContent = msg;
  }
  function showSuccess(msg) {
    notif.className = "notification success";
    notif.style.display = "block";
    notifMsg.textContent = msg;
  }
</script>
</body>
</html>